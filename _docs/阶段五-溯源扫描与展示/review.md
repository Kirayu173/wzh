# 阶段五评审报告（溯源扫描与展示）

## 1. 评审范围
- Android 客户端：溯源扫码入口、详情页、扫码记录
- 后端服务：溯源批次/物流节点/二维码接口、TraceService、实体与仓库
- 阶段五文档：Spec/决策清单/Code/Test/Review

## 2. 评审方法
- 静态代码走读
- 自动化测试结果复核（后端 `mvn test`、Android Lint）
- 关键业务流程一致性检查（扫码→详情→记录、权限校验）

## 3. 评审发现
- 代码质量：后端 Controller/Service/Repository 分层清晰，DTO 定义明确；Android MVP 结构稳定，Room 访问集中且职责清楚
- 架构设计：traceCode 短码、聚合详情接口、Room 本地记录符合 ADR 决策；管理员接口权限校验符合 Spec
- 性能：物流节点按 `node_time` 倒序查询，前端再排序兜底；扫码记录本地读取，性能开销可控
- 安全性：管理员接口校验角色，二维码返回二进制；需确认 `/trace/{traceCode}` 的访问策略与安全配置一致
- 可维护性：Trace 相关提示文案部分为硬编码，后续维护与多语言支持成本略高

## 4. 改进建议
- 将 Trace 扫码/记录的提示文案统一迁移至 `strings.xml`，减少硬编码
- 若业务可能出现非 ISO 时间格式，建议前端进行时间解析排序或直接依赖后端排序结果
- 若 `process_info` 可能超长，生产库建议使用 TEXT 类型并补充迁移脚本

## 5. 风险评估
- 低风险：`process_info` 长度限制为 2000，极端长文本可能被截断
- 低风险：traceCode 采用日期+随机数生成，高并发下存在轻微冲突概率（已重试缓解）
- 低风险：需确认 `/trace` 接口是否允许匿名访问，避免与安全策略不一致
