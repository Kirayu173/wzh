# 阶段四关键待决策点（建议版）

1) 支付实现方案
- 推荐：模拟支付（调用 `POST /orders/{id}/pay` 更新状态）
- 可选：接入支付宝/微信 SDK（密钥/回调配置【待查证】）
- 理由：阶段四目标是打通“下单-支付”最小闭环，模拟支付成本低、风险小，便于验收演示。

2) 订单地址存储策略
- 推荐：保存地址快照（receiver/phone/address）到订单
- 可选：仅保存 address_id（下单后展示时实时关联地址）
- 理由：地址快照可确保历史订单信息不受地址后续编辑影响，展示更稳定；address_id 方案冗余低但需处理地址变更带来的历史不一致。

3) 下单来源策略
- 推荐：从购物车“选中项”创建订单
- 可选：立即购买直达下单（单品模式）
- 理由：阶段三已完成购物车选中/数量逻辑，复用现有流程能降低接口与前端改动成本。

4) 订单状态枚举与流转
- 推荐：`PENDING_PAY` → `PAID` → `SHIPPED` → `COMPLETED`，并支持 `CANCELED`
- 可选：用数值状态码（1/2/3/4/9）与文本映射
- 理由：明确状态枚举有利于前后端一致展示；`SHIPPED` 状态为阶段六“发货”预留。

5) 库存扣减时机
- 推荐：下单时扣减库存，取消订单时回滚库存（如实现取消）
- 可选：支付成功后扣减库存
- 理由：下单扣减可降低超卖风险，但需配合取消回滚；支付扣减实现简单但会出现并发超卖风险。

> 备注：上述方案为推荐选项，若变更需同步调整后端订单接口、状态机与客户端交互逻辑。
